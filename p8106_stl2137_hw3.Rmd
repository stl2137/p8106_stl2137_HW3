---
title: "p8106_stl2137_HW3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ISLR)
library(caret)
```

#Loading in data 

```{r}
data(Weekly)
weekly_dat <- Weekly[-8] %>% 
  janitor::clean_names()
```

## Part A
(a) Produce some graphical summaries of the Weekly data.
```{r}
featurePlot(x = weekly_dat[, 2:7], 
            y = weekly_dat$direction,
            scales = list(x=list(relation="free"), 
                          y=list(relation="free")),
            plot = "density", pch = "|", 
            auto.key = list(columns = 2))
```

## Part B

```{r}
glm_fit <- glm(direction ~ lag1 + lag2 + lag3 + lag4 + lag5 + volume, 
               data = weekly_dat, 
               family = binomial)

summary(glm_fit)
```

After running `summary(glm_fit)`, it appears that when $\alpha = 0.05$, only lag2 is a statisically significant predictor. 

## Part C

(c) Briefly explain what the confusion matrix is telling you.
```{r}
### Split Data in Train and Test
set.seed(1)
row_train <- createDataPartition(y = weekly_dat$direction,
                                p = 0.8,
                                list = FALSE)

### Building Confusion Matrix

test_pred_prob <- predict(glm_fit, newdata = weekly_dat[-row_train,],
                          type = "response")

test_pred <- rep("Down", length(test_pred_prob))
test_pred[test_pred_prob > 0.5] <- "Up"

confusionMatrix(data = as.factor(test_pred),
                reference = weekly_dat$direction[-row_train],
                positive = "Up")

```

## Part D

```{r}
roc_glm <- roc(weekly_dat$direction[-row_train], test_pred_prob)
plot(roc_glm, legacy.axes = TRUE, print.auc = TRUE)
plot(smooth(roc_glm), col = 2, add = TRUE)
```

The AUC is 0.550. 

## Part E
(e) Now fit the logistic regression model using a training data period from 1990 to 2008, with Lag1 and Lag2 as the predictors. Plot the ROC curve using the held out data (that is, the data from 2009 and 2010) and report the AUC.

```{r}
### Creating Year Split Training and Test Data
year_train_dat <- weekly_dat %>% 
  filter(year < 2009)

year_test_dat <- weekly_dat %>% 
  filter(year > 2008)
```

```{r}
### Fit logistic regression model
year_glm_fit <- glm(direction ~ lag1 + lag2, 
                    data = year_train_dat, 
                    family = binomial)

### Plotting the ROC curve
year_pred_prob <- predict(year_glm_fit, newdata = year_train_dat,
                          type = "response")
year_pred <- rep("Down", length(year_pred_prob))
year_pred[year_pred_prob > 0.5] <- "Up"

roc_year <- roc(year_train_dat$direction, year_pred_prob)
plot(roc_year, legacy.axes = TRUE, print.auc = TRUE)
```

The AUC of the logistic regression model using a training data period from 1990 to 2008, with Lag1 and Lag2 as the predictors is 0.555. 

## Part F
(f) Repeat (e) using LDA and QDA.
```{r}

```


